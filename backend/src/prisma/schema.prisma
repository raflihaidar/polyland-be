generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum CertificateStatus {
  AKTIF
  DALAM_PROSES
  BERMASALAH
  TIDAK_AKTIF
}

enum ApplicationStatus {
  DIAJUKAN
  DIPROSES
  PERBAIKAN_BERKAS
  DITOLAK
  SELESAI
}

enum Section {
  DASHBOARD
  MASTER
  SETTING
}

model Person {
  id             String  @id @default(uuid()) @db.Uuid
  wallet_address String? @unique @db.VarChar(50)

  name     String  @db.VarChar(150)
  username String  @unique @db.VarChar(100)
  password String  @db.VarChar(100)
  nik      String? @unique @db.VarChar(150)
  address  String? @db.Text
  phone    String? @db.VarChar(100)
  email    String  @unique @db.VarChar(150)

  nonce     String?  @db.VarChar(100)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  DeedOwner    Deed[]        @relation("DeedOwner")
  DeedCreator  Deed[]        @relation("DeedCreator")
  certificates Certificate[]
  applications Application[]
  roles        RolePerson[]

  @@map("persons")
}

model Land {
  id        String @id @default(uuid()) @db.Uuid
  area_size String @db.VarChar(100)
  address   String @db.Text

  north_boundary String @db.VarChar(100)
  south_boundary String @db.VarChar(100)
  west_boundary  String @db.VarChar(100)
  east_boundary  String @db.VarChar(100)
  latitude       String @db.VarChar(100)
  longitude      String @db.VarChar(100)

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now())
  certificates Certificate[]
  applications Application[]

  @@map("lands")
}

model Certificate {
  id        String             @id @default(uuid()) @db.Uuid
  number    String             @unique @db.VarChar(100)
  land_id   String             @db.Uuid
  owner_id  String             @db.Uuid
  cid       String             @db.VarChar(255)
  status    CertificateStatus?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @default(now())

  land  Land   @relation(fields: [land_id], references: [id])
  owner Person @relation(fields: [owner_id], references: [id])

  @@map("cerfiticates")
}

model Deed {
  id          String @id @default(uuid()) @db.Uuid
  number      String @unique @db.VarChar(100)
  description String @db.VarChar(150)
  cid         String @db.VarChar(255)

  person_id String @db.Uuid
  createdBy String @db.Uuid

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner   Person @relation("DeedOwner", fields: [person_id], references: [id])
  creator Person @relation("DeedCreator", fields: [createdBy], references: [id])

  @@map("deeds")
}

model Application {
  id        String            @id @default(uuid()) @db.Uuid
  person_id String            @db.Uuid
  land_id   String            @db.Uuid
  status    ApplicationStatus @default(DIAJUKAN)
  type      String
  notes     String            @db.VarChar(200)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @default(now())

  land                 Land                  @relation(fields: [land_id], references: [id])
  person               Person                @relation(fields: [person_id], references: [id])
  applicationDocuments ApplicationDocument[]

  @@map("applications")
}

model ApplicationDocument {
  id             String   @id @default(uuid()) @db.Uuid
  application_id String   @db.Uuid
  cid            String   @db.VarChar(255)
  description    String   @db.VarChar(150)
  createdAt      DateTime @default(now())

  application Application @relation(fields: [application_id], references: [id])

  @@map("application_documents")
}

model Module {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(50)
  slug        String       @unique @db.VarChar(50)
  description String?
  section     String?
  privileges  Privilege[]
  groupId     Int?         @map("group_id")
  moduleGroup ModuleGroup? @relation(fields: [groupId], references: [id])

  @@map("modules")
}

model ModuleGroup {
  id      Int      @id @default(autoincrement())
  name    String   @unique @db.VarChar(50)
  slug    String   @unique @db.VarChar(100)
  section Section
  modules Module[]

  @@map("module_groups")
}

model Role {
  id          Int             @id @default(autoincrement())
  name        String          @unique
  description String?
  created_at  DateTime        @default(now())
  privileges  RolePrivilege[]
  rolePersons RolePerson[]

  @@map("roles")
}

model Privilege {
  id        Int             @id @default(autoincrement())
  name      String          @db.VarChar(50)
  module_id Int
  action    String
  module    Module          @relation(fields: [module_id], references: [id])
  roles     RolePrivilege[]

  @@map("privileges")
}

model RolePrivilege {
  id           Int       @id @default(autoincrement())
  role_id      Int
  privilege_id Int
  created_at   DateTime  @default(now())
  role         Role      @relation(fields: [role_id], references: [id])
  privilege    Privilege @relation(fields: [privilege_id], references: [id])

  @@unique([role_id, privilege_id])
  @@map("role_privileges")
}

model RolePerson {
  id         Int      @id @default(autoincrement())
  role_id    Int
  person_id  String   @db.Uuid
  created_at DateTime @default(now())
  person     Person   @relation(fields: [person_id], references: [id])
  role       Role     @relation(fields: [role_id], references: [id])

  @@map("role_persons")
}
